<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register Pelayanan 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        background: #eef2f7;
      }

      header {
        background: linear-gradient(90deg, #0054d1, #0096ff);
        color: white;
        padding: 25px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        letter-spacing: 1px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 18px;
        padding: 25px;
      }

      .card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        font-weight: bold;
        transition: 0.25s;
        border: 2px solid transparent;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
      }

      .card:hover {
        background: #e9f2ff;
        transform: scale(1.04);
        border-color: #007bff;
      }

      .chart-btn {
        margin: 10px 25px;
        padding: 12px 25px;
        background: #00a94f;
        border: none;
        color: white;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: 0.2s;
      }

      .chart-btn:hover {
        background: #008f43;
        transform: scale(1.05);
      }

      .form-section {
        display: none;
        background: white;
        padding: 25px;
        border-top: 4px solid #007bff;
        margin: 20px;
        border-radius: 12px;
        box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.12);
      }

      .form-section.active {
        display: block;
      }

      form {
        max-width: 650px;
        margin: auto;
      }

      label {
        margin-top: 12px;
        display: block;
        font-weight: bold;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccd2dd;
        margin-top: 5px;
      }

      button {
        margin-top: 15px;
        background: #007bff;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        font-size: 15px;
        animation: fadeIn 0.4s ease-in-out;
      }

      button:hover {
        background: #005fcc;
      }

      table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
        border-radius: 10px;
        overflow: hidden;
      }

      th,
      td {
        padding: 10px;
        border: 1px solid #d5d9e0;
        text-align: center;
      }

      th {
        background: #dee6f7;
        font-weight: bold;
      }

      .delete-btn {
        background: #dc3545;
        padding: 6px 12px;
        border-radius: 6px;
      }

      .delete-btn:hover {
        background: #b92b38;
      }

      .print-button {
        background: #17a52f;
        float: right;
        margin-bottom: 15px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <header>
      REGISTER PELAYANAN 2026<br />
      <small>KECAMATAN SUMEDANG SELATAN</small>
    </header>

    <section id="dashboard" class="dashboard"></section>

    <button class="chart-btn" onclick="openChartPage()">
      Lihat Grafik Pelayanan
    </button>

    <section id="formSection" class="form-section">
      <h2 id="formTitle">Form Pelayanan</h2>

      <form id="serviceForm">
        <input type="hidden" id="jenisPelayanan" />

        <label>Nomor:</label>
        <input id="nomor" required />

        <label>Nama Pemohon:</label>
        <input id="namaPemohon" required />

        <label>Tanggal Pelayanan:</label>
        <input type="date" id="tanggalPelayanan" required />

        <label>Nomor NIK:</label>
        <input id="nomorNIK" />

        <label>Alamat:</label>
        <input id="alamat" required />

        <label>Status:</label>
        <select id="statusPelayanan">
          <option>Selesai</option>
          <option>Dalam Proses</option>
          <option>Ditolak</option>
        </select>

        <label>Keterangan:</label>
        <textarea id="keterangan" rows="3"></textarea>

        <button type="submit">üíæ Simpan Data</button>
      </form>

      <h3>üìÅ Data Tersimpan</h3>
      <button class="print-button" onclick="printTable()">
        üñ® Cetak Dokumen
      </button>

      <table>
        <thead>
          <tr>
            <th>No</th>
            <th>Nama</th>
            <th>Tanggal</th>
            <th>NIK</th>
            <th>Alamat</th>
            <th>Status</th>
            <th>Keterangan</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="dataTable"></tbody>
      </table>
    </section>

    <script>
      const jenisPelayananList = [
        "Rekomendasi Penerbitan KTP ‚Äì el",
        "Rekomendasi Penerbitan KK",
        "Rekomendasi Pengajuan Kredit ke Bank",
        "Rekomendasi Surat Pindah Datang",
        "Perekaman KTP - el",
        "Legalisir Dokumen",
        "Rekomendasi Surat Keterangan Ahli Waris",
        "Rekomendasi Pengantar Ijin Rame-rame",
        "Rekomendasi SKCK",
        "Rekomendasi  Semua Jenis Surat Keterangan",
        "Rekomendasi Ibadah Haji & Umrah",
        "Rekomendasi Proposal Permohonan Bantuan Dana",
        "Akta Jual Beli Tanah / Bangunan",
        "CEKATAN (Cetak Kartu Keluarga di Kecamatan)",
        "Pelayanan IKD",
        ];

      const dashboard = document.getElementById("dashboard");
      const formSection = document.getElementById("formSection");
      const dataTable = document.getElementById("dataTable");
      const jenisInput = document.getElementById("jenisPelayanan");
      const formTitle = document.getElementById("formTitle");
      let currentJenis = "";

      jenisPelayananList.forEach((jenis) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerText = jenis;
        card.onclick = () => openForm(jenis);
        dashboard.appendChild(card);
      });

      function openForm(jenis) {
        currentJenis = jenis;
        jenisInput.value = jenis;
        formTitle.innerText = `Form ${jenis}`;
        formSection.classList.add("active");
        loadTable(jenis);
      }

      function getData(jenis) {
        return JSON.parse(localStorage.getItem(jenis)) || [];
      }
      function saveData(jenis, data) {
        const existing = getData(jenis);
        existing.push(data);
        localStorage.setItem(jenis, JSON.stringify(existing));
      }

      function deleteRow(i) {
        const data = getData(currentJenis);
        data.splice(i, 1);
        localStorage.setItem(currentJenis, JSON.stringify(data));
        loadTable(currentJenis);
      }

      function loadTable(jenis) {
        const data = getData(jenis);
        dataTable.innerHTML = "";
        data.forEach((row, i) => {
          dataTable.innerHTML += `
        <tr>
        <td>${row.nomor}</td><td>${row.nama}</td><td>${row.tanggal}</td><td>${row.nomorNIK}</td>
        <td>${row.alamat}</td><td>${row.status}</td><td>${row.keterangan}</td>
        <td><button class="delete-btn" onclick="deleteRow(${i})">Hapus</button></td>
        </tr>`;
        });
      }

      serviceForm.onsubmit = (e) => {
        e.preventDefault();
        saveData(currentJenis, {
          nomor: nomor.value,
          nama: namaPemohon.value,
          tanggal: tanggalPelayanan.value,
          nomorNIK: nomorNIK.value,
          alamat: alamat.value,
          status: statusPelayanan.value,
          keterangan: keterangan.value,
        });
        serviceForm.reset();
        loadTable(currentJenis);
      };

      function printTable() {
        window.print();
      }

      function openChartPage() {
        const win = window.open("", "width=1000,height=800");

        win.document.write(`
<style>
  body { font-family: Segoe UI, sans-serif; padding: 20px; background: #f5f7fa; }
  h2 { text-align: center; margin-bottom: 10px; font-weight: bold; }
  button {
    background: #005eff;
    color: white;
    padding: 10px 18px;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    font-size: 15px;
    margin-bottom: 15px;
  }
  button:hover { background: #003cb3; }
  canvas { width: 100% !important; height: 500px !important; }
</style>

<button onclick="window.close()">‚¨Ö Kembali</button>
<h2>Grafik Rekap Pelayanan 2026</h2>
<canvas id="chart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"><\/script>
`);

        win.document.write(`
<script>
  const layanan = ${JSON.stringify(jenisPelayananList)};
  const jumlah = layanan.map(j => JSON.parse(localStorage.getItem(j))?.length || 0);

  // ===== Warna Tetap per Jenis Layanan =====
  function getStoredColors() {
    let saved = JSON.parse(localStorage.getItem("warnaLayanan"));
    if (!saved) saved = {};
    return saved;
  }

  function generateColor() {
    return "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, "0");
  }

  function assignColors() {
    let stored = getStoredColors();
    layanan.forEach(l => {
      if (!stored[l]) stored[l] = generateColor();
    });
    localStorage.setItem("warnaLayanan", JSON.stringify(stored));
    return stored;
  }

  const warnaLayanan = assignColors();
  const warnaFinal = layanan.map(l => warnaLayanan[l]);

  function buatGrafik() {
    new Chart(document.getElementById("chart"), {
      type: 'bar',
      data: {
        labels: layanan.map(l => l.length > 28 ? l.slice(0,28) + ".." : l),
        datasets: [{
          data: jumlah,
          backgroundColor: warnaFinal,
          borderColor: "#000",
          borderWidth: 1
        }]
      },
      options: {
        layout: { padding: { top: 30 }},
        plugins: {
          legend: { display: false },
          tooltip: { enabled: true },
          datalabels: {
            anchor: 'end',
            align: 'top',
            font: { weight: 'bold', size: 14 },
            color: "#000"
          }
        },
        responsive: true,
        maintainAspectRatio: false,
        scales: { 
          x: {
            ticks: { maxRotation: 40, minRotation: 0, font: { size: 11 }},
            grid: { display: false }
          },
          y: {
            beginAtZero: true,
            ticks: { stepSize: 5 }
          }
        }
      },
      plugins: [ChartDataLabels]
    });
  }

  setTimeout(buatGrafik, 200);
<\/script>
`);

        win.document.close();
      }
    </script>
  </body>
</html>



